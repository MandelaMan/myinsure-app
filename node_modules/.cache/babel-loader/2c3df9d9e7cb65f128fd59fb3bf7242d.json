{"ast":null,"code":"var _jsxFileName = \"C:\\\\React\\\\myinsure-app\\\\src\\\\context\\\\GlobalState.js\",\n    _s = $RefreshSig$();\n\nimport React, { createContext, useReducer, useEffect } from \"react\";\nimport AppReducer from \"./AppReducer\";\nimport axios from \"axios\";\nimport jwt from \"jwt-simple\";\nimport { encryptData, decryptData } from \"../utils/helpers\";\nimport Cookies from \"js-cookie\";\nimport Swal from \"sweetalert2\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isLoggedin: false,\n  userCheck: false,\n  isLoading: null,\n  shouldChangePassword: false,\n  privilege: \"\",\n  globals: {},\n  user_info: {},\n  dependant_info: [],\n  leave_info: {},\n  leave_history: [],\n  leave_approvals: [],\n  next_of_kin: [],\n  staff: [],\n  message: \"\",\n  slip_info: {},\n  downloadSlip: false\n};\nexport const GlobalContext = /*#__PURE__*/createContext(initialState);\nexport const GlobalProvider = ({\n  children\n}) => {\n  _s();\n\n  const [state, dispatch] = useReducer(AppReducer, initialState);\n\n  const addCookie = (payload, cookie_name) => {\n    var date = new Date();\n    var minutes = 30;\n    date.setTime(date.getTime() + minutes * 60 * 10000);\n    Cookies.set(cookie_name, payload, {\n      expires: date\n    });\n  };\n\n  const deleteCookie = () => {\n    var cookie = document.cookie.split(\";\");\n\n    for (var i = 0; i < cookie.length; i++) {\n      var chip = cookie[i],\n          entry = chip.split(\"=\"),\n          name = entry[0];\n      Cookies.remove(name);\n      document.cookie = name + \"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\n    }\n  }; // Base URL for the API\n  // hint: remember to remove trailling slash\n\n\n  const baseURL = \"https://portal.micglobalrisks.com:8082/portal/api\"; // const baseURL = \"http://localhost:81/portal/api\";\n\n  function tokenInfo() {\n    if (localStorage.LOGIN_INFO) {\n      var secret = process.env.REACT_APP_SECRET;\n      var token = localStorage.LOGIN_INFO;\n      var decoded = jwt.decode(token, secret);\n      return decoded;\n    }\n\n    return false;\n  }\n\n  function setGlobalInfo() {\n    const check_token = tokenInfo();\n    dispatch({\n      type: \"SET_GLOBAL_INFO\",\n      payload: check_token.data\n    });\n  }\n\n  function setMessage(text = \"\") {\n    dispatch({\n      type: \"MESSAGE\",\n      payload: text\n    });\n  }\n\n  function loginStatus() {\n    let login = false;\n\n    if (localStorage.LOGIN_INFO) {\n      login = true;\n      setGlobalInfo();\n    }\n\n    dispatch({\n      type: \"LOG_STATUS\",\n      payload: login\n    });\n    setMessage(\"\");\n  }\n\n  function loadingStatus(to_set) {\n    dispatch({\n      type: \"SET_LOADING\",\n      payload: to_set\n    });\n  }\n\n  useEffect(() => {\n    setGlobalInfo();\n    loginStatus();\n    const interval = setInterval(() => {\n      if (localStorage.LOGIN_INFO) {//getUserDetails(true);\n        // pass a parameter that tells the function to skip the set cookie and pull from the database\n      }\n    }, 10000);\n    return () => clearInterval(interval); // eslint-disable-next-line\n  }, []);\n\n  async function checkUsername(inputs) {\n    const config = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    const res = await axios.post(`${baseURL}/user/check_user`, inputs, config);\n\n    if (res.data.error) {\n      setMessage(\"Confirm that the email is correct\");\n    }\n\n    if (!res.data.error) {\n      if (res.data.data === undefined) {\n        Swal.fire({\n          icon: \"info\",\n          html: \"<h5>Server is under maintenance.<br/> Please try again later</h5>\"\n        });\n      } else {\n        const {\n          username,\n          password_changed\n        } = res.data.data;\n        const payload = {\n          userchecked: true,\n          updatepass: !password_changed\n        };\n        dispatch({\n          type: \"CHECK_USER\",\n          payload\n        });\n        localStorage.username = username;\n      }\n    }\n\n    loadingStatus(false);\n  }\n\n  async function updatePassword(inputs) {\n    inputs.email = localStorage.username;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const res = await axios.post(`${baseURL}/user/change_password`, inputs, config);\n\n      if (!res.data.error) {\n        if (res.data.data === undefined) {\n          Swal.fire({\n            icon: \"info\",\n            html: \"<h5>Server is under maintenance.<br/> Please try again later</h5>\"\n          });\n        } else {\n          const {\n            token\n          } = res.data.data;\n          localStorage.LOGIN_INFO = token;\n          loginStatus();\n          localStorage.removeItem(\"username\");\n          setTimeout(() => {\n            getUserDetails();\n            getLeaveDetails();\n            getLeaveHistory();\n          }, 10);\n        }\n      }\n    } catch (error) {}\n\n    loadingStatus(false);\n  }\n\n  async function handleLogin(inputs) {\n    inputs.email = localStorage.username;\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      const res = await axios.post(`${baseURL}/user/login`, inputs, config);\n\n      if (!res.data.error) {\n        if (res.data.data === undefined) {\n          Swal.fire({\n            icon: \"info\",\n            html: \"<h5>Server is under maintenance.<br/> Please try again later</h5>\"\n          });\n        } else {\n          const {\n            token\n          } = res.data.data;\n          localStorage.LOGIN_INFO = token;\n          localStorage.removeItem(\"username\");\n          loginStatus();\n          setTimeout(() => {\n            getUserDetails();\n            getLeaveDetails();\n            getLeaveHistory();\n          }, 10);\n        }\n      }\n\n      if (res.data.error) {\n        setMessage(\"Password is incorrect\");\n      }\n    } catch (error) {}\n\n    loadingStatus(false);\n  }\n\n  async function handleLogout() {\n    dispatch({\n      type: \"LOG_OUT\"\n    });\n    localStorage.clear();\n    Cookies.remove(\"__details\");\n    Cookies.remove(\"__dependent_details\");\n    Cookies.remove(\"__kin_details\");\n    Cookies.remove(\"__leave_details\");\n    Cookies.remove(\"__leave_history\");\n    Cookies.remove(\"__leave_approvals\");\n    loadingStatus(false);\n    setMessage(); //window.location.reload();\n  }\n\n  async function getUserDetails() {\n    const details = Cookies.get(\"__details\");\n\n    if (details) {\n      dispatch({\n        type: \"GET_USER_INFO\",\n        payload: decryptData(details)\n      });\n    } else {\n      const info = tokenInfo();\n      loadingStatus(true);\n\n      try {\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: localStorage.LOGIN_INFO\n          }\n        };\n        const res = await axios.get(`${baseURL}/user/info?username=${info.data.username}`, config);\n\n        if (!res.data.error) {\n          if (res.data.data === null) {\n            Swal.fire(\"Server unavailable. Try again later\");\n          }\n\n          addCookie(encryptData(res.data.data), \"__details\");\n          dispatch({\n            type: \"GET_USER_INFO\",\n            payload: res.data.data\n          }); // if (res.data.picture !== null) {\n          //   window.prof_pic = res.data.picture;\n          // }\n\n          getAllNextOfKin();\n        }\n\n        loadingStatus(false);\n      } catch (error) {}\n    }\n  }\n\n  async function getStaff() {\n    const staff = localStorage.__staff;\n\n    if (staff) {\n      dispatch({\n        type: \"GET_ALL_STAFF\",\n        payload: decryptData(staff)\n      });\n    } else {\n      loadingStatus(true);\n\n      try {\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: localStorage.LOGIN_INFO\n          }\n        };\n        const res = await axios.get(`${baseURL}/staff/all`, config);\n\n        if (!res.data.error && res.data.data != null) {\n          localStorage.__staff = encryptData(res.data.data);\n          dispatch({\n            type: \"GET_ALL_STAFF\",\n            payload: res.data.data\n          });\n        }\n      } catch (error) {}\n    }\n\n    loadingStatus(false);\n  }\n\n  async function deleteSlip(id) {\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: localStorage.LOGIN_INFO\n        }\n      };\n      const res = await axios.get(`${baseURL}/user/unlink_slip?id=${id}`, config);\n\n      if (!res.data.error) {\n        dispatch({\n          type: \"GET_PAYSLIP\",\n          payload: false\n        });\n      }\n    } catch (error) {}\n  }\n\n  async function getPaySlip() {\n    const info = tokenInfo();\n\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: localStorage.LOGIN_INFO\n        }\n      };\n      const res = await axios.get(`${baseURL}/user/slip?username=${info.data.username}`, config);\n\n      if (!res.data.error) {\n        dispatch({\n          type: \"GET_PAYSLIP\",\n          payload: true\n        });\n        loadingStatus(false);\n      }\n    } catch (error) {}\n  }\n\n  async function getLeaveDetails() {\n    const leave_details = Cookies.get(\"__leave_details\");\n\n    if (leave_details) {\n      dispatch({\n        type: \"GET_LEAVE_INFO\",\n        payload: decryptData(leave_details)\n      });\n    } else {\n      loadingStatus(true);\n      const info = tokenInfo();\n\n      try {\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: localStorage.LOGIN_INFO\n          }\n        };\n        const res = await axios.get(`${baseURL}/leave/info?email=${info.data.username}`, config);\n\n        if (!res.data.error) {\n          addCookie(encryptData(res.data.data), \"__leave_details\");\n          dispatch({\n            type: \"GET_LEAVE_INFO\",\n            payload: res.data.data\n          });\n        }\n      } catch (error) {}\n    }\n\n    loadingStatus(false);\n  }\n\n  async function getLeaveHistory() {\n    const leave_history = Cookies.get(\"__leave_history\");\n\n    if (leave_history) {\n      dispatch({\n        type: \"GET_LEAVE_HISTORY\",\n        payload: decryptData(leave_history)\n      });\n    } else {\n      const info = tokenInfo();\n\n      try {\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: localStorage.LOGIN_INFO\n          }\n        };\n        const res = await axios.get(`${baseURL}/leave/history?email=${info.data.username}`, config);\n\n        if (!res.data.error) {\n          addCookie(encryptData(res.data.data), \"__leave_history\");\n          dispatch({\n            type: \"GET_LEAVE_HISTORY\",\n            payload: res.data.data\n          }); //check if manage and call approvals\n\n          if (info.data.role === 1) {\n            getLeaveApprovals();\n          }\n        }\n      } catch (error) {}\n    }\n  }\n\n  async function applyForLeave(inputs) {\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: localStorage.LOGIN_INFO\n        }\n      };\n      const res = await axios.post(`${baseURL}/leave/apply`, inputs, config);\n      console.log(res);\n\n      if (!res.data.error) {\n        Cookies.remove(\"__leave_history\");\n        getLeaveHistory();\n        setMessage(res.data.message);\n      }\n    } catch (error) {}\n  }\n\n  async function uploadProfile(file, staff, ext, username) {\n    const formData = new FormData(); //SAVES TO CLOUD...................................................................\n    // formData.append(\"file\", file);\n    // formData.append(\"upload_preset\", \"zPre53t101\");\n    // formData.append(\"cloud_name\", \"mandelamanscloud\");\n    // const res = await axios.post(\n    //   `https://api.cloudinary.com/v1_1/mandelamanscloud/image/upload`,\n    //   formData,\n    //   {\n    //     headers: {\n    //       \"Content-Type\": \"multipart/form-data\",\n    //     },\n    //   }\n    // );\n    // SAVES TO IIS..................................................................\n\n    formData.append(\"avatar\", file);\n    formData.append(\"staff\", staff);\n    formData.append(\"extension\", ext);\n    const res = await axios.post(`${baseURL}/user/upload_picture`, formData, {\n      headers: {\n        \"Content-Type\": \"multipart/form-data\",\n        Authorization: localStorage.LOGIN_INFO\n      }\n    });\n    console.log(res.data);\n    return res.data.error;\n  }\n\n  async function updateProfile(inputs) {\n    if (typeof inputs.picture !== \"undefined\") {\n      const extension = inputs.picture.name.split(\".\")[1];\n      uploadProfile(inputs.picture, inputs.staff, extension, inputs.username);\n    } // try {\n    //   const config = {\n    //     headers: {\n    //       \"Content-Type\": \"application/json\",\n    //       Authorization: localStorage.LOGIN_INFO,\n    //     },\n    //   };\n    //   const res = await axios.post(\n    //     `${baseURL}/user/edit_profile`,\n    //     inputs,\n    //     config\n    //   );\n    //   console.log(res);\n    //   Cookies.remove(\"__details\");\n    //   getUserDetails();\n    // } catch (error) {}\n\n  }\n\n  async function addDependent(inputs) {\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: localStorage.LOGIN_INFO\n        }\n      };\n      const res = await axios.post(`${baseURL}/user/add_dependent`, inputs, config); //console.log(res);\n\n      Cookies.remove(\"__dependent_details\");\n      getAllDependents();\n    } catch (error) {}\n  }\n\n  async function getAllDependents() {\n    const dependent_details = Cookies.get(\"__dependent_details\");\n\n    if (dependent_details) {\n      dispatch({\n        type: \"GET_DEPENDENTS\",\n        payload: decryptData(dependent_details)\n      });\n    } else {\n      const info = tokenInfo();\n\n      try {\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: localStorage.LOGIN_INFO\n          }\n        };\n        const res = await axios.get(`${baseURL}/user/get_dependents?username=${info.data.username}`, config);\n\n        if (!res.data.error && res.data.data != null) {\n          addCookie(encryptData(res.data.data), \"__dependent_details\");\n          dispatch({\n            type: \"GET_DEPENDENTS\",\n            payload: res.data.data\n          });\n        }\n      } catch (error) {}\n    }\n  }\n\n  async function addNextOfKin(inputs) {\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: localStorage.LOGIN_INFO\n        }\n      };\n      const res = await axios.post(`${baseURL}/user/add_next_of_kin`, inputs, config); //console.log(res);\n\n      Cookies.remove(\"__kin_details\");\n      getAllNextOfKin(); // if (!res.data.error) {\n      //   Cookies.remove(\"__leave_history\");\n      //   getLeaveHistory();\n      //   setMessage(res.data.message);\n      // }\n    } catch (error) {}\n  }\n\n  async function getAllNextOfKin() {\n    const kin_details = Cookies.get(\"__kin_details\");\n\n    if (kin_details) {\n      dispatch({\n        type: \"GET_NEXT_OF_KIN\",\n        payload: decryptData(kin_details)\n      });\n    } else {\n      const info = tokenInfo();\n\n      try {\n        const config = {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: localStorage.LOGIN_INFO\n          }\n        };\n        const res = await axios.get(`${baseURL}/user/get_next_of_kin?username=${info.data.username}`, config);\n\n        if (!res.data.error && res.data.data != null) {\n          // console.log(res.data.data);\n          addCookie(encryptData(res.data.data), \"__kin_details\");\n          dispatch({\n            type: \"GET_NEXT_OF_KIN\",\n            payload: res.data.data\n          });\n        }\n      } catch (error) {}\n    }\n  } // async function getReturnDate(start_date, duration, type) {\n  //   try {\n  //     const config = {\n  //       headers: {\n  //         \"Content-Type\": \"application/json\",\n  //         Authorization: localStorage.LOGIN_INFO,\n  //       },\n  //     };\n  //     const res = await axios.get(\n  //       `${baseURL}/leave/return_leave_date?start_date=${start_date}&type=${type}&duration=${duration}`,\n  //       config\n  //     );\n  //     console.log(res);\n  //     if (!res.data.error) {\n  //       addCookie(encryptData(res.data.data), \"__leave_approvals\");\n  //       dispatch({\n  //         type: \"GET_LEAVE_APPROVALS\",\n  //         payload: res.data.data,\n  //       });\n  //     }\n  //   } catch (error) {}\n  // }\n\n\n  async function getLeaveApprovals() {\n    const info = tokenInfo();\n\n    if (info.data.role > 0) {\n      const leave_approvals = Cookies.get(\"__leave_approvals\");\n\n      if (leave_approvals) {\n        dispatch({\n          type: \"GET_LEAVE_APPROVALS\",\n          payload: decryptData(leave_approvals)\n        });\n      } else {\n        try {\n          const config = {\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: localStorage.LOGIN_INFO\n            }\n          };\n          const res = await axios.get(`${baseURL}/leave/approvals?email=${info.data.username}`, config);\n\n          if (!res.data.error && res.data.data != null) {\n            addCookie(encryptData(res.data.data), \"__leave_approvals\");\n            dispatch({\n              type: \"GET_LEAVE_APPROVALS\",\n              payload: res.data.data\n            });\n          }\n        } catch (error) {}\n      }\n    }\n  }\n\n  async function approveLeave(leave_no, action) {\n    try {\n      const config = {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: localStorage.LOGIN_INFO\n        }\n      };\n      const res = await axios.get(`${baseURL}/leave/requests?leave_no=${leave_no}&action=${action}`, config);\n\n      if (!res.data.error) {\n        Cookies.remove(\"__leave_approvals\");\n        getLeaveApprovals();\n      }\n    } catch (error) {}\n  }\n\n  return /*#__PURE__*/_jsxDEV(GlobalContext.Provider, {\n    value: {\n      loadingStatus,\n      loginStatus,\n      handleLogin,\n      handleLogout,\n      setMessage,\n      updatePassword,\n      checkUsername,\n      getLeaveDetails,\n      applyForLeave,\n      getUserDetails,\n      getLeaveHistory,\n      getLeaveApprovals,\n      approveLeave,\n      addNextOfKin,\n      getStaff,\n      updateProfile,\n      // getReturnDate,\n      getAllDependents,\n      addDependent,\n      getAllNextOfKin,\n      getPaySlip,\n      deleteSlip,\n      downloadSlip: state.downloadSlip,\n      staff: state.staff,\n      next_of_kin: state.next_of_kin,\n      globals: state.globals,\n      dependant_info: state.dependant_info,\n      leave_approvals: state.leave_approvals,\n      privilege: state.privilege,\n      leave_history: state.leave_history,\n      user_info: state.user_info,\n      leave_info: state.leave_info,\n      userCheck: state.userCheck,\n      passwordCheck: state.passwordCheck,\n      isLoading: state.isLoading,\n      message: state.message,\n      shouldChangePassword: state.shouldChangePassword,\n      isLoggedin: state.isLoggedin\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 746,\n    columnNumber: 5\n  }, this);\n};\n\n_s(GlobalProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c = GlobalProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"GlobalProvider\");","map":{"version":3,"sources":["C:/React/myinsure-app/src/context/GlobalState.js"],"names":["React","createContext","useReducer","useEffect","AppReducer","axios","jwt","encryptData","decryptData","Cookies","Swal","initialState","isLoggedin","userCheck","isLoading","shouldChangePassword","privilege","globals","user_info","dependant_info","leave_info","leave_history","leave_approvals","next_of_kin","staff","message","slip_info","downloadSlip","GlobalContext","GlobalProvider","children","state","dispatch","addCookie","payload","cookie_name","date","Date","minutes","setTime","getTime","set","expires","deleteCookie","cookie","document","split","i","length","chip","entry","name","remove","baseURL","tokenInfo","localStorage","LOGIN_INFO","secret","process","env","REACT_APP_SECRET","token","decoded","decode","setGlobalInfo","check_token","type","data","setMessage","text","loginStatus","login","loadingStatus","to_set","interval","setInterval","clearInterval","checkUsername","inputs","config","headers","res","post","error","undefined","fire","icon","html","username","password_changed","userchecked","updatepass","updatePassword","email","removeItem","setTimeout","getUserDetails","getLeaveDetails","getLeaveHistory","handleLogin","handleLogout","clear","details","get","info","Authorization","getAllNextOfKin","getStaff","__staff","deleteSlip","id","getPaySlip","leave_details","role","getLeaveApprovals","applyForLeave","console","log","uploadProfile","file","ext","formData","FormData","append","updateProfile","picture","extension","addDependent","getAllDependents","dependent_details","addNextOfKin","kin_details","approveLeave","leave_no","action","passwordCheck"],"mappings":"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","sourcesContent":["import React, { createContext, useReducer, useEffect } from \"react\";\r\nimport AppReducer from \"./AppReducer\";\r\nimport axios from \"axios\";\r\nimport jwt from \"jwt-simple\";\r\nimport { encryptData, decryptData } from \"../utils/helpers\";\r\nimport Cookies from \"js-cookie\";\r\nimport Swal from \"sweetalert2\";\r\n\r\nconst initialState = {\r\n  isLoggedin: false,\r\n  userCheck: false,\r\n  isLoading: null,\r\n  shouldChangePassword: false,\r\n  privilege: \"\",\r\n  globals: {},\r\n  user_info: {},\r\n  dependant_info: [],\r\n  leave_info: {},\r\n  leave_history: [],\r\n  leave_approvals: [],\r\n  next_of_kin: [],\r\n  staff: [],\r\n  message: \"\",\r\n  slip_info: {},\r\n  downloadSlip: false,\r\n};\r\n\r\nexport const GlobalContext = createContext(initialState);\r\n\r\nexport const GlobalProvider = ({ children }) => {\r\n  const [state, dispatch] = useReducer(AppReducer, initialState);\r\n\r\n  const addCookie = (payload, cookie_name) => {\r\n    var date = new Date();\r\n    var minutes = 30;\r\n    date.setTime(date.getTime() + minutes * 60 * 10000);\r\n\r\n    Cookies.set(cookie_name, payload, {\r\n      expires: date,\r\n    });\r\n  };\r\n\r\n  const deleteCookie = () => {\r\n    var cookie = document.cookie.split(\";\");\r\n\r\n    for (var i = 0; i < cookie.length; i++) {\r\n      var chip = cookie[i],\r\n        entry = chip.split(\"=\"),\r\n        name = entry[0];\r\n\r\n      Cookies.remove(name);\r\n\r\n      document.cookie = name + \"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\r\n    }\r\n  };\r\n\r\n  // Base URL for the API\r\n  // hint: remember to remove trailling slash\r\n  const baseURL = \"https://portal.micglobalrisks.com:8082/portal/api\";\r\n  // const baseURL = \"http://localhost:81/portal/api\";\r\n\r\n  function tokenInfo() {\r\n    if (localStorage.LOGIN_INFO) {\r\n      var secret = process.env.REACT_APP_SECRET;\r\n      var token = localStorage.LOGIN_INFO;\r\n\r\n      var decoded = jwt.decode(token, secret);\r\n      return decoded;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function setGlobalInfo() {\r\n    const check_token = tokenInfo();\r\n\r\n    dispatch({\r\n      type: \"SET_GLOBAL_INFO\",\r\n      payload: check_token.data,\r\n    });\r\n  }\r\n\r\n  function setMessage(text = \"\") {\r\n    dispatch({\r\n      type: \"MESSAGE\",\r\n      payload: text,\r\n    });\r\n  }\r\n\r\n  function loginStatus() {\r\n    let login = false;\r\n\r\n    if (localStorage.LOGIN_INFO) {\r\n      login = true;\r\n      setGlobalInfo();\r\n    }\r\n\r\n    dispatch({\r\n      type: \"LOG_STATUS\",\r\n      payload: login,\r\n    });\r\n\r\n    setMessage(\"\");\r\n  }\r\n\r\n  function loadingStatus(to_set) {\r\n    dispatch({\r\n      type: \"SET_LOADING\",\r\n      payload: to_set,\r\n    });\r\n  }\r\n\r\n  useEffect(() => {\r\n    setGlobalInfo();\r\n    loginStatus();\r\n\r\n    const interval = setInterval(() => {\r\n      if (localStorage.LOGIN_INFO) {\r\n        //getUserDetails(true);\r\n        // pass a parameter that tells the function to skip the set cookie and pull from the database\r\n      }\r\n    }, 10000);\r\n\r\n    return () => clearInterval(interval); // eslint-disable-next-line\r\n  }, []);\r\n\r\n  async function checkUsername(inputs) {\r\n    const config = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    };\r\n\r\n    const res = await axios.post(`${baseURL}/user/check_user`, inputs, config);\r\n\r\n    if (res.data.error) {\r\n      setMessage(\"Confirm that the email is correct\");\r\n    }\r\n\r\n    if (!res.data.error) {\r\n      if (res.data.data === undefined) {\r\n        Swal.fire({\r\n          icon: \"info\",\r\n          html: \"<h5>Server is under maintenance.<br/> Please try again later</h5>\",\r\n        });\r\n      } else {\r\n        const { username, password_changed } = res.data.data;\r\n\r\n        const payload = {\r\n          userchecked: true,\r\n          updatepass: !password_changed,\r\n        };\r\n\r\n        dispatch({\r\n          type: \"CHECK_USER\",\r\n          payload,\r\n        });\r\n\r\n        localStorage.username = username;\r\n      }\r\n    }\r\n\r\n    loadingStatus(false);\r\n  }\r\n\r\n  async function updatePassword(inputs) {\r\n    inputs.email = localStorage.username;\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(\r\n        `${baseURL}/user/change_password`,\r\n        inputs,\r\n        config\r\n      );\r\n\r\n      if (!res.data.error) {\r\n        if (res.data.data === undefined) {\r\n          Swal.fire({\r\n            icon: \"info\",\r\n            html: \"<h5>Server is under maintenance.<br/> Please try again later</h5>\",\r\n          });\r\n        } else {\r\n          const { token } = res.data.data;\r\n          localStorage.LOGIN_INFO = token;\r\n          loginStatus();\r\n          localStorage.removeItem(\"username\");\r\n          setTimeout(() => {\r\n            getUserDetails();\r\n            getLeaveDetails();\r\n            getLeaveHistory();\r\n          }, 10);\r\n        }\r\n      }\r\n    } catch (error) {}\r\n\r\n    loadingStatus(false);\r\n  }\r\n\r\n  async function handleLogin(inputs) {\r\n    inputs.email = localStorage.username;\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(`${baseURL}/user/login`, inputs, config);\r\n\r\n      if (!res.data.error) {\r\n        if (res.data.data === undefined) {\r\n          Swal.fire({\r\n            icon: \"info\",\r\n            html: \"<h5>Server is under maintenance.<br/> Please try again later</h5>\",\r\n          });\r\n        } else {\r\n          const { token } = res.data.data;\r\n          localStorage.LOGIN_INFO = token;\r\n          localStorage.removeItem(\"username\");\r\n          loginStatus();\r\n\r\n          setTimeout(() => {\r\n            getUserDetails();\r\n            getLeaveDetails();\r\n            getLeaveHistory();\r\n          }, 10);\r\n        }\r\n      }\r\n\r\n      if (res.data.error) {\r\n        setMessage(\"Password is incorrect\");\r\n      }\r\n    } catch (error) {}\r\n\r\n    loadingStatus(false);\r\n  }\r\n\r\n  async function handleLogout() {\r\n    dispatch({\r\n      type: \"LOG_OUT\",\r\n    });\r\n\r\n    localStorage.clear();\r\n\r\n    Cookies.remove(\"__details\");\r\n    Cookies.remove(\"__dependent_details\");\r\n    Cookies.remove(\"__kin_details\");\r\n    Cookies.remove(\"__leave_details\");\r\n    Cookies.remove(\"__leave_history\");\r\n    Cookies.remove(\"__leave_approvals\");\r\n\r\n    loadingStatus(false);\r\n\r\n    setMessage();\r\n\r\n    //window.location.reload();\r\n  }\r\n\r\n  async function getUserDetails() {\r\n    const details = Cookies.get(\"__details\");\r\n\r\n    if (details) {\r\n      dispatch({\r\n        type: \"GET_USER_INFO\",\r\n        payload: decryptData(details),\r\n      });\r\n    } else {\r\n      const info = tokenInfo();\r\n      loadingStatus(true);\r\n\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: localStorage.LOGIN_INFO,\r\n          },\r\n        };\r\n        const res = await axios.get(\r\n          `${baseURL}/user/info?username=${info.data.username}`,\r\n          config\r\n        );\r\n\r\n        if (!res.data.error) {\r\n          if (res.data.data === null) {\r\n            Swal.fire(\"Server unavailable. Try again later\");\r\n          }\r\n\r\n          addCookie(encryptData(res.data.data), \"__details\");\r\n\r\n          dispatch({\r\n            type: \"GET_USER_INFO\",\r\n            payload: res.data.data,\r\n          });\r\n\r\n          // if (res.data.picture !== null) {\r\n          //   window.prof_pic = res.data.picture;\r\n          // }\r\n\r\n          getAllNextOfKin();\r\n        }\r\n        loadingStatus(false);\r\n      } catch (error) {}\r\n    }\r\n  }\r\n\r\n  async function getStaff() {\r\n    const staff = localStorage.__staff;\r\n\r\n    if (staff) {\r\n      dispatch({\r\n        type: \"GET_ALL_STAFF\",\r\n        payload: decryptData(staff),\r\n      });\r\n    } else {\r\n      loadingStatus(true);\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: localStorage.LOGIN_INFO,\r\n          },\r\n        };\r\n\r\n        const res = await axios.get(`${baseURL}/staff/all`, config);\r\n\r\n        if (!res.data.error && res.data.data != null) {\r\n          localStorage.__staff = encryptData(res.data.data);\r\n\r\n          dispatch({\r\n            type: \"GET_ALL_STAFF\",\r\n            payload: res.data.data,\r\n          });\r\n        }\r\n      } catch (error) {}\r\n    }\r\n\r\n    loadingStatus(false);\r\n  }\r\n\r\n  async function deleteSlip(id) {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: localStorage.LOGIN_INFO,\r\n        },\r\n      };\r\n      const res = await axios.get(\r\n        `${baseURL}/user/unlink_slip?id=${id}`,\r\n        config\r\n      );\r\n\r\n      if (!res.data.error) {\r\n        dispatch({\r\n          type: \"GET_PAYSLIP\",\r\n          payload: false,\r\n        });\r\n      }\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function getPaySlip() {\r\n    const info = tokenInfo();\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: localStorage.LOGIN_INFO,\r\n        },\r\n      };\r\n      const res = await axios.get(\r\n        `${baseURL}/user/slip?username=${info.data.username}`,\r\n        config\r\n      );\r\n\r\n      if (!res.data.error) {\r\n        dispatch({\r\n          type: \"GET_PAYSLIP\",\r\n          payload: true,\r\n        });\r\n        loadingStatus(false);\r\n      }\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function getLeaveDetails() {\r\n    const leave_details = Cookies.get(\"__leave_details\");\r\n\r\n    if (leave_details) {\r\n      dispatch({\r\n        type: \"GET_LEAVE_INFO\",\r\n        payload: decryptData(leave_details),\r\n      });\r\n    } else {\r\n      loadingStatus(true);\r\n      const info = tokenInfo();\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: localStorage.LOGIN_INFO,\r\n          },\r\n        };\r\n        const res = await axios.get(\r\n          `${baseURL}/leave/info?email=${info.data.username}`,\r\n          config\r\n        );\r\n        if (!res.data.error) {\r\n          addCookie(encryptData(res.data.data), \"__leave_details\");\r\n          dispatch({\r\n            type: \"GET_LEAVE_INFO\",\r\n            payload: res.data.data,\r\n          });\r\n        }\r\n      } catch (error) {}\r\n    }\r\n\r\n    loadingStatus(false);\r\n  }\r\n\r\n  async function getLeaveHistory() {\r\n    const leave_history = Cookies.get(\"__leave_history\");\r\n\r\n    if (leave_history) {\r\n      dispatch({\r\n        type: \"GET_LEAVE_HISTORY\",\r\n        payload: decryptData(leave_history),\r\n      });\r\n    } else {\r\n      const info = tokenInfo();\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: localStorage.LOGIN_INFO,\r\n          },\r\n        };\r\n        const res = await axios.get(\r\n          `${baseURL}/leave/history?email=${info.data.username}`,\r\n          config\r\n        );\r\n\r\n        if (!res.data.error) {\r\n          addCookie(encryptData(res.data.data), \"__leave_history\");\r\n          dispatch({\r\n            type: \"GET_LEAVE_HISTORY\",\r\n            payload: res.data.data,\r\n          });\r\n\r\n          //check if manage and call approvals\r\n          if (info.data.role === 1) {\r\n            getLeaveApprovals();\r\n          }\r\n        }\r\n      } catch (error) {}\r\n    }\r\n  }\r\n\r\n  async function applyForLeave(inputs) {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: localStorage.LOGIN_INFO,\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(`${baseURL}/leave/apply`, inputs, config);\r\n\r\n      console.log(res);\r\n\r\n      if (!res.data.error) {\r\n        Cookies.remove(\"__leave_history\");\r\n        getLeaveHistory();\r\n        setMessage(res.data.message);\r\n      }\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function uploadProfile(file, staff, ext, username) {\r\n    const formData = new FormData();\r\n\r\n    //SAVES TO CLOUD...................................................................\r\n\r\n    // formData.append(\"file\", file);\r\n    // formData.append(\"upload_preset\", \"zPre53t101\");\r\n    // formData.append(\"cloud_name\", \"mandelamanscloud\");\r\n\r\n    // const res = await axios.post(\r\n    //   `https://api.cloudinary.com/v1_1/mandelamanscloud/image/upload`,\r\n    //   formData,\r\n    //   {\r\n    //     headers: {\r\n    //       \"Content-Type\": \"multipart/form-data\",\r\n    //     },\r\n    //   }\r\n    // );\r\n\r\n    // SAVES TO IIS..................................................................\r\n\r\n    formData.append(\"avatar\", file);\r\n    formData.append(\"staff\", staff);\r\n    formData.append(\"extension\", ext);\r\n\r\n    const res = await axios.post(`${baseURL}/user/upload_picture`, formData, {\r\n      headers: {\r\n        \"Content-Type\": \"multipart/form-data\",\r\n        Authorization: localStorage.LOGIN_INFO,\r\n      },\r\n    });\r\n\r\n    console.log(res.data);\r\n\r\n    return res.data.error;\r\n  }\r\n\r\n  async function updateProfile(inputs) {\r\n    if (typeof inputs.picture !== \"undefined\") {\r\n      const extension = inputs.picture.name.split(\".\")[1];\r\n      uploadProfile(inputs.picture, inputs.staff, extension, inputs.username);\r\n    }\r\n\r\n    // try {\r\n    //   const config = {\r\n    //     headers: {\r\n    //       \"Content-Type\": \"application/json\",\r\n    //       Authorization: localStorage.LOGIN_INFO,\r\n    //     },\r\n    //   };\r\n    //   const res = await axios.post(\r\n    //     `${baseURL}/user/edit_profile`,\r\n    //     inputs,\r\n    //     config\r\n    //   );\r\n    //   console.log(res);\r\n    //   Cookies.remove(\"__details\");\r\n    //   getUserDetails();\r\n    // } catch (error) {}\r\n  }\r\n\r\n  async function addDependent(inputs) {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: localStorage.LOGIN_INFO,\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(\r\n        `${baseURL}/user/add_dependent`,\r\n        inputs,\r\n        config\r\n      );\r\n      //console.log(res);\r\n      Cookies.remove(\"__dependent_details\");\r\n      getAllDependents();\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function getAllDependents() {\r\n    const dependent_details = Cookies.get(\"__dependent_details\");\r\n\r\n    if (dependent_details) {\r\n      dispatch({\r\n        type: \"GET_DEPENDENTS\",\r\n        payload: decryptData(dependent_details),\r\n      });\r\n    } else {\r\n      const info = tokenInfo();\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: localStorage.LOGIN_INFO,\r\n          },\r\n        };\r\n\r\n        const res = await axios.get(\r\n          `${baseURL}/user/get_dependents?username=${info.data.username}`,\r\n          config\r\n        );\r\n\r\n        if (!res.data.error && res.data.data != null) {\r\n          addCookie(encryptData(res.data.data), \"__dependent_details\");\r\n          dispatch({\r\n            type: \"GET_DEPENDENTS\",\r\n            payload: res.data.data,\r\n          });\r\n        }\r\n      } catch (error) {}\r\n    }\r\n  }\r\n\r\n  async function addNextOfKin(inputs) {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: localStorage.LOGIN_INFO,\r\n        },\r\n      };\r\n\r\n      const res = await axios.post(\r\n        `${baseURL}/user/add_next_of_kin`,\r\n        inputs,\r\n        config\r\n      );\r\n\r\n      //console.log(res);\r\n      Cookies.remove(\"__kin_details\");\r\n      getAllNextOfKin();\r\n\r\n      // if (!res.data.error) {\r\n      //   Cookies.remove(\"__leave_history\");\r\n      //   getLeaveHistory();\r\n      //   setMessage(res.data.message);\r\n      // }\r\n    } catch (error) {}\r\n  }\r\n\r\n  async function getAllNextOfKin() {\r\n    const kin_details = Cookies.get(\"__kin_details\");\r\n\r\n    if (kin_details) {\r\n      dispatch({\r\n        type: \"GET_NEXT_OF_KIN\",\r\n        payload: decryptData(kin_details),\r\n      });\r\n    } else {\r\n      const info = tokenInfo();\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: localStorage.LOGIN_INFO,\r\n          },\r\n        };\r\n\r\n        const res = await axios.get(\r\n          `${baseURL}/user/get_next_of_kin?username=${info.data.username}`,\r\n          config\r\n        );\r\n\r\n        if (!res.data.error && res.data.data != null) {\r\n          // console.log(res.data.data);\r\n          addCookie(encryptData(res.data.data), \"__kin_details\");\r\n          dispatch({\r\n            type: \"GET_NEXT_OF_KIN\",\r\n            payload: res.data.data,\r\n          });\r\n        }\r\n      } catch (error) {}\r\n    }\r\n  }\r\n\r\n  // async function getReturnDate(start_date, duration, type) {\r\n  //   try {\r\n  //     const config = {\r\n  //       headers: {\r\n  //         \"Content-Type\": \"application/json\",\r\n  //         Authorization: localStorage.LOGIN_INFO,\r\n  //       },\r\n  //     };\r\n  //     const res = await axios.get(\r\n  //       `${baseURL}/leave/return_leave_date?start_date=${start_date}&type=${type}&duration=${duration}`,\r\n  //       config\r\n  //     );\r\n\r\n  //     console.log(res);\r\n\r\n  //     if (!res.data.error) {\r\n  //       addCookie(encryptData(res.data.data), \"__leave_approvals\");\r\n  //       dispatch({\r\n  //         type: \"GET_LEAVE_APPROVALS\",\r\n  //         payload: res.data.data,\r\n  //       });\r\n  //     }\r\n  //   } catch (error) {}\r\n  // }\r\n\r\n  async function getLeaveApprovals() {\r\n    const info = tokenInfo();\r\n\r\n    if (info.data.role > 0) {\r\n      const leave_approvals = Cookies.get(\"__leave_approvals\");\r\n\r\n      if (leave_approvals) {\r\n        dispatch({\r\n          type: \"GET_LEAVE_APPROVALS\",\r\n          payload: decryptData(leave_approvals),\r\n        });\r\n      } else {\r\n        try {\r\n          const config = {\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n              Authorization: localStorage.LOGIN_INFO,\r\n            },\r\n          };\r\n          const res = await axios.get(\r\n            `${baseURL}/leave/approvals?email=${info.data.username}`,\r\n            config\r\n          );\r\n\r\n          if (!res.data.error && res.data.data != null) {\r\n            addCookie(encryptData(res.data.data), \"__leave_approvals\");\r\n            dispatch({\r\n              type: \"GET_LEAVE_APPROVALS\",\r\n              payload: res.data.data,\r\n            });\r\n          }\r\n        } catch (error) {}\r\n      }\r\n    }\r\n  }\r\n\r\n  async function approveLeave(leave_no, action) {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: localStorage.LOGIN_INFO,\r\n        },\r\n      };\r\n      const res = await axios.get(\r\n        `${baseURL}/leave/requests?leave_no=${leave_no}&action=${action}`,\r\n        config\r\n      );\r\n\r\n      if (!res.data.error) {\r\n        Cookies.remove(\"__leave_approvals\");\r\n        getLeaveApprovals();\r\n      }\r\n    } catch (error) {}\r\n  }\r\n\r\n  return (\r\n    <GlobalContext.Provider\r\n      value={{\r\n        loadingStatus,\r\n        loginStatus,\r\n        handleLogin,\r\n        handleLogout,\r\n        setMessage,\r\n        updatePassword,\r\n        checkUsername,\r\n        getLeaveDetails,\r\n        applyForLeave,\r\n        getUserDetails,\r\n        getLeaveHistory,\r\n        getLeaveApprovals,\r\n        approveLeave,\r\n        addNextOfKin,\r\n        getStaff,\r\n        updateProfile,\r\n        // getReturnDate,\r\n        getAllDependents,\r\n        addDependent,\r\n        getAllNextOfKin,\r\n        getPaySlip,\r\n        deleteSlip,\r\n        downloadSlip: state.downloadSlip,\r\n        staff: state.staff,\r\n        next_of_kin: state.next_of_kin,\r\n        globals: state.globals,\r\n        dependant_info: state.dependant_info,\r\n        leave_approvals: state.leave_approvals,\r\n        privilege: state.privilege,\r\n        leave_history: state.leave_history,\r\n        user_info: state.user_info,\r\n        leave_info: state.leave_info,\r\n        userCheck: state.userCheck,\r\n        passwordCheck: state.passwordCheck,\r\n        isLoading: state.isLoading,\r\n        message: state.message,\r\n        shouldChangePassword: state.shouldChangePassword,\r\n        isLoggedin: state.isLoggedin,\r\n      }}\r\n    >\r\n      {children}\r\n    </GlobalContext.Provider>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}